{% extends "base.html" %}
{% block page_title %}Session History{% endblock %}
{% block page_subtitle %}Cashier sessions and reconciliations{% endblock %}

{% block content %}
<div class="bg-gray-900 border border-gray-800 rounded-xl overflow-hidden shadow-sm">
    <table class="w-full text-sm">
        <thead class="bg-gray-800/50 text-xs font-semibold text-gray-500 uppercase tracking-wider">
            <tr class="text-left border-b border-gray-800">
                <th class="px-6 py-4">Status</th>
                <th class="px-6 py-4">Cashier</th>
                <th class="px-6 py-4 text-right">Started</th>
                <th class="px-6 py-4 text-right">Opening Balance</th>
                <th class="px-6 py-4 text-right">System Sales</th>
                <th class="px-6 py-4 text-right">Closing Balance</th>
                <th class="px-6 py-4 text-right">Discrepancy</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-800/60">
            {% for s in sessions %}
            <tr class="hover:bg-gray-800/40 transition-colors">
                <td class="px-6 py-4">
                    {% if s.is_active %}
                    <span
                        class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-500/10 text-green-400 border border-green-500/20">
                        Active
                    </span>
                    {% else %}
                    <span
                        class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-700 text-gray-400">
                        Closed
                    </span>
                    {% endif %}
                </td>
                <td class="px-6 py-4">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-8 h-8 rounded-full bg-brand-900/50 flex items-center justify-center text-xs font-bold text-brand-400 border border-brand-800">
                            {{ s.cashier.name[:1] }}
                        </div>
                        <div>
                            <p class="font-medium text-white">{{ s.cashier.name }}</p>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 text-right text-gray-400 font-mono text-xs">
                    {{ s.start_time.strftime('%Y-%m-%d %H:%M') }}
                </td>
                <td class="px-6 py-4 text-right text-gray-300 font-mono">
                    ₹{{ '{:.2f}'.format(s.opening_cash) }}
                </td>
                <td class="px-6 py-4 text-right text-brand-400 font-medium font-mono">
                    ₹{{ '{:.2f}'.format(s.system_total) }}
                </td>
                <td class="px-6 py-4 text-right text-white font-mono">
                    {% if s.closing_cash %}₹{{ '{:.2f}'.format(s.closing_cash) }}{% else %}<span
                        class="text-gray-600 italic">-</span>{% endif %}
                </td>
                <td class="px-6 py-4 text-right font-mono">
                    {% if s.closing_cash %}
                    {% set diff = s.discrepancy %}
                    {% if diff == 0 %}
                    <span class="text-green-500 text-xs bg-green-500/10 px-2 py-1 rounded">MATCH</span>
                    {% elif diff > 0 %}
                    <span class="text-green-400 text-xs bg-green-500/10 px-2 py-1 rounded font-bold">+{{
                        '{:.2f}'.format(diff) }}</span>
                    {% else %}
                    <span class="text-red-400 text-xs bg-red-500/10 px-2 py-1 rounded font-bold">{{
                        '{:.2f}'.format(diff) }}</span>
                    {% endif %}
                    {% else %}
                    <span class="text-gray-600">-</span>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                    No session history found.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}